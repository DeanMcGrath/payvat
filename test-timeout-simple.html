<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Timeout Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .loading { background: #ffeaa7; }
        .success { background: #00b894; color: white; }
        .error { background: #e17055; color: white; }
        .info { background: #74b9ff; color: white; }
    </style>
</head>
<body>
    <h1>Dashboard Loading Test</h1>
    <div id="status"></div>
    <div id="dashboard-content"></div>
    
    <script>
        function addStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `${new Date().toISOString().split('T')[1].split('.')[0]} - ${message}`;
            status.appendChild(div);
            console.log(message);
        }

        async function testDashboard() {
            addStatus('Starting dashboard loading test...', 'info');
            
            // Create an iframe to load the dashboard
            const iframe = document.createElement('iframe');
            iframe.src = 'https://vat-pay-ireland-mp4uyht21-deans-projects-cdf015cf.vercel.app/dashboard/documents';
            iframe.style.width = '100%';
            iframe.style.height = '600px';
            iframe.style.border = '1px solid #ccc';
            
            let loadingTimeout = false;
            
            // Set a timer to check if loading persists
            const timer = setTimeout(() => {
                addStatus('3 seconds elapsed - checking for timeout logic...', 'info');
                loadingTimeout = true;
                
                // Try to check iframe content (may be blocked by CORS)
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const text = iframeDoc.body ? iframeDoc.body.innerText : 'Cannot access iframe content (CORS)';
                    
                    if (text.includes('Loading dashboard')) {
                        addStatus('Dashboard still showing loading - timeout logic may not be working', 'error');
                    } else if (text.includes('Sales Documents') || text.includes('Purchase Documents')) {
                        addStatus('Dashboard content is now visible!', 'success');
                    } else {
                        addStatus('Dashboard shows different content: ' + text.substring(0, 100), 'info');
                    }
                } catch (e) {
                    addStatus('Cannot check iframe content due to CORS - this is expected', 'info');
                }
                
                // Add a message for the user
                addStatus('Test completed. Check the iframe below to see the dashboard state:', 'info');
            }, 3500);
            
            iframe.onload = () => {
                addStatus('Dashboard iframe loaded', 'success');
            };
            
            iframe.onerror = (error) => {
                addStatus('Error loading dashboard: ' + error.message, 'error');
                clearTimeout(timer);
            };
            
            document.getElementById('dashboard-content').appendChild(iframe);
        }

        // Start the test when page loads
        window.addEventListener('load', testDashboard);
    </script>
</body>
</html>